<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" class="dark-mode">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<!-- BEGIN opengraph metadata -->
<meta property="og:title" content="SolarResult Dinnis Core API Documentation" />
<meta property="og:description" content="API documentation for SolarResult Dinnis Core - IoT firmware for smart meter gateway device built with Zephyr RTOS on Nordic nRF9161" />
<!-- END opengraph metadata -->
<!-- Favicon -->
<link rel="icon" type="image/svg+xml" href="solar_result_white.svg">
<title>SolarResult Dinnis Core: LED Module - Documentatie</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="doxygen-awesome-tabs.js"></script>
<script type="text/javascript">
    // Initialize Doxygen Awesome features (dark mode only, no toggle)
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeParagraphLink.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeTabs.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="solar_result_white.svg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SolarResult Dinnis Core
   </div>
   <div id="projectbrief">Dinnis Rev1.0.0 Firmware - IoT Gateway for DSMR P1 Smart Meters</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('led_doc.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">LED Module - Documentatie </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_modules_2led_2led__doc"></a></p>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md96"></a>
üîó Navigatie</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Sectie  </th><th class="markdownTableHeadNone">Link  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">üìö <b>API Referentie</b>  </td><td class="markdownTableBodyNone"><a class="el" href="group__led.html">LED - API Referentie</a> - Module groep met alle functies, structs, en macros  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">üìÑ <b>Source Files</b>  </td><td class="markdownTableBodyNone"><a class="el" href="led_8c.html">led.c</a> - Implementatie  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">üìÑ <b>Header Files</b>  </td><td class="markdownTableBodyNone"><a class="el" href="led_8h.html">led.h</a> - Public API en data structures  </td></tr>
</table>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md98"></a>
Overzicht</h1>
<p>De LED module biedt visuele status indicatie door een RGB LED aan te sturen op basis van systeem events (network status, cloud status, data acquisitie). Het implementeert verschillende LED patronen voor verschillende system states.</p>
<p>De module gebruikt non-blocking PWM timers voor smooth color transitions en blink patronen.</p>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md100"></a>
Waarom? (Probleem &amp; Motivatie)</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md101"></a>
Visuele Feedback voor IoT Device</h2>
<p><b>Probleem</b>: Embedded IoT devices hebben geen display. Gebruikers moeten kunnen zien:</p><ul>
<li>Is het apparaat aan? (boot sequence)</li>
<li>Is het netwerk verbonden? (LTE-M/NB-IoT)</li>
<li>Is cloud connectie actief? (nRF Cloud)</li>
<li>Wordt er data verzameld? (P1 acquisitie)</li>
<li>Is er een error? (watchdog reset, modem failure)</li>
</ul>
<p><b>Oplossing</b>: RGB LED met verschillende kleuren en patronen - zie de volledige tabel hieronder in de "Wat?" sectie.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md102"></a>
Non-Blocking LED Control</h2>
<p><b>Design Rationale</b>: LED animaties (blink, fade) moeten smooth zijn zonder main thread te blokkeren.</p>
<p><b>Oplossing</b>:</p><ul>
<li>PWM hardware voor color control (geen CPU overhead)</li>
<li>k_timer voor blink patronen (interrupt driven)</li>
<li>State based pattern selection (event driven updates)</li>
</ul>
<p><b>Voordeel</b>: LED updates kosten &lt; 1% CPU, geen impact op critical timing.</p>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md104"></a>
Wat? (Functionaliteit &amp; Data Flow)</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md105"></a>
LED Status Patronen</h2>
<p>De LED module gebruikt een <b>priority-based systeem</b>: wanneer meerdere condities tegelijk actief zijn, wordt het patroon met de hoogste prioriteit getoond.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Priority  </th><th class="markdownTableHeadNone">Status  </th><th class="markdownTableHeadNone">Kleur  </th><th class="markdownTableHeadNone">RGB (0-100)  </th><th class="markdownTableHeadNone">Patroon  </th><th class="markdownTableHeadNone">Betekenis  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>6</b>  </td><td class="markdownTableBodyNone"><span class="tt">LED_STATUS_FOTA</span>  </td><td class="markdownTableBodyNone">üü¢ Groen  </td><td class="markdownTableBodyNone">(0,100,0)  </td><td class="markdownTableBodyNone">4 Hz blink (250ms)  </td><td class="markdownTableBodyNone">FOTA firmware download actief  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>5</b>  </td><td class="markdownTableBodyNone"><span class="tt">LED_STATUS_NETWORK_ERROR</span>  </td><td class="markdownTableBodyNone">üî¥ Rood  </td><td class="markdownTableBodyNone">(100,0,0)  </td><td class="markdownTableBodyNone">2 Hz blink (500ms)  </td><td class="markdownTableBodyNone">Netwerk disconnected  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>5</b>  </td><td class="markdownTableBodyNone"><span class="tt">LED_STATUS_FOTA_ERROR</span>  </td><td class="markdownTableBodyNone">üî¥ Rood  </td><td class="markdownTableBodyNone">(100,0,0)  </td><td class="markdownTableBodyNone">Constant ON  </td><td class="markdownTableBodyNone">FOTA download error (kritiek)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>4</b>  </td><td class="markdownTableBodyNone"><span class="tt">LED_STATUS_CLOUD_ERROR</span>  </td><td class="markdownTableBodyNone">üü† Oranje  </td><td class="markdownTableBodyNone">(100,50,0)  </td><td class="markdownTableBodyNone">1 Hz blink (1000ms)  </td><td class="markdownTableBodyNone">Cloud niet ready  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>3</b>  </td><td class="markdownTableBodyNone"><span class="tt">LED_STATUS_ACQUIRING</span>  </td><td class="markdownTableBodyNone">üîµ Blauw  </td><td class="markdownTableBodyNone">(0,0,100)  </td><td class="markdownTableBodyNone">5 Hz blink (200ms)  </td><td class="markdownTableBodyNone">Data acquisitie van P1 meter  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>2</b>  </td><td class="markdownTableBodyNone"><span class="tt">LED_STATUS_CLOUD_TX</span>  </td><td class="markdownTableBodyNone">üü¢ Groen  </td><td class="markdownTableBodyNone">(0,100,0)  </td><td class="markdownTableBodyNone">10 Hz blink (100ms)  </td><td class="markdownTableBodyNone">Cloud data transmissie (‚ö†Ô∏è disabled in code)  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>1</b>  </td><td class="markdownTableBodyNone"><span class="tt">LED_STATUS_IDLE</span>  </td><td class="markdownTableBodyNone">üü¢ Groen  </td><td class="markdownTableBodyNone">(0,100,0)  </td><td class="markdownTableBodyNone">1 Hz blink (1000ms)  </td><td class="markdownTableBodyNone">Normal operation - standby  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>0</b>  </td><td class="markdownTableBodyNone"><span class="tt">LED_STATUS_WAIT</span>  </td><td class="markdownTableBodyNone">üü° Warm Wit  </td><td class="markdownTableBodyNone">(100,20,20)  </td><td class="markdownTableBodyNone">Constant ON  </td><td class="markdownTableBodyNone">Boot/initialisatie fase  </td></tr>
</table>
<p><b>Priority Logic Voorbeeld</b>:</p><ul>
<li>Network OK + Cloud ready + Geen activiteit ‚Üí <span class="tt">LED_STATUS_IDLE</span> (priority 1) - Groen slow blink</li>
<li>FOTA download start ‚Üí <span class="tt">LED_STATUS_FOTA</span> (priority 6) - Overschrijft alles, groen fast blink</li>
<li>FOTA error ‚Üí <span class="tt">LED_STATUS_FOTA_ERROR</span> (priority 5) - Rood constant</li>
<li>Na FOTA completion ‚Üí Terug naar <span class="tt">LED_STATUS_IDLE</span> (priority 1)</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md106"></a>
ZBUS Interfaces</h2>
<p><b>Subscribed Channels</b>:</p><ul>
<li><span class="tt">NETWORK_CHAN</span> - LTE-M/NB-IoT connection updates</li>
<li><span class="tt">CLOUD_CHAN</span> - nRF Cloud connection updates</li>
<li><span class="tt">FOTA_CHAN</span> - FOTA download status and progress</li>
<li><span class="tt">TRIGGER_CHAN</span> - Data acquisition triggers (P1 readings)</li>
</ul>
<p><b>Published Channels</b>:</p><ul>
<li>Geen - pure consumer module</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md107"></a>
Typische Scenario's</h2>
<p><b>Boot Sequence</b>: </p><div class="fragment"><div class="line">Power ON</div>
<div class="line">  ‚Üì</div>
<div class="line">LED = WARM WIT constant (LED_STATUS_WAIT - priority 0)</div>
<div class="line">RGB = (100,20,20) - Roodachtige tint voor &quot;warning&quot;</div>
<div class="line">  ‚Üì</div>
<div class="line">Network connecting...</div>
<div class="line">  ‚Üì</div>
<div class="line">LED = ROOD blink (LED_STATUS_NETWORK_ERROR - priority 5)</div>
<div class="line">  ‚Üì</div>
<div class="line">Network connected, cloud connecting...</div>
<div class="line">  ‚Üì</div>
<div class="line">LED = ORANJE blink (LED_STATUS_CLOUD_ERROR - priority 4)</div>
<div class="line">  ‚Üì</div>
<div class="line">Cloud ready!</div>
<div class="line">  ‚Üì</div>
<div class="line">LED = GROEN slow blink (LED_STATUS_IDLE - priority 1)</div>
</div><!-- fragment --><p><b>Data Acquisitie</b>: </p><div class="fragment"><div class="line">LED = GROEN slow blink (idle)</div>
<div class="line">  ‚Üì</div>
<div class="line">P1 trigger ontvangen</div>
<div class="line">  ‚Üì</div>
<div class="line">LED = BLAUW fast blink (LED_STATUS_ACQUIRING - priority 3)</div>
<div class="line">  ‚Üì</div>
<div class="line">Data gelezen (~2 seconden)</div>
<div class="line">  ‚Üì</div>
<div class="line">LED = GROEN slow blink (terug naar idle)</div>
</div><!-- fragment --><p><b>Cloud Data Transmissie</b>: </p><div class="fragment"><div class="line">LED = GROEN slow blink (idle)</div>
<div class="line">  ‚Üì</div>
<div class="line">Cloud TX start</div>
<div class="line">  ‚Üì</div>
<div class="line">LED = GROEN very fast blink (LED_STATUS_CLOUD_TX - priority 2)</div>
<div class="line">  ‚Üì</div>
<div class="line">TX compleet</div>
<div class="line">  ‚Üì</div>
<div class="line">LED = GROEN slow blink (terug naar idle)</div>
</div><!-- fragment --><p><b>FOTA Update</b>: </p><div class="fragment"><div class="line">LED = GROEN slow blink (idle)</div>
<div class="line">  ‚Üì</div>
<div class="line">FOTA download start</div>
<div class="line">  ‚Üì</div>
<div class="line">LED = GROEN 4Hz blink (LED_STATUS_FOTA - priority 6, hoogste!)</div>
<div class="line">  ‚Üì</div>
<div class="line">Download compleet ‚Üí reboot</div>
<div class="line">  ‚Üì</div>
<div class="line">Na reboot: LED = WARM WIT ‚Üí ... ‚Üí GROEN slow blink</div>
</div><!-- fragment --><p><b>Error Situatie</b>: </p><div class="fragment"><div class="line">LED = GROEN slow blink (operationeel)</div>
<div class="line">  ‚Üì</div>
<div class="line">Network connection verloren</div>
<div class="line">  ‚Üì</div>
<div class="line">LED = ROOD blink (LED_STATUS_NETWORK_ERROR - priority 5)</div>
<div class="line">  ‚Üì</div>
<div class="line">Network hersteld</div>
<div class="line">  ‚Üì</div>
<div class="line">LED = GROEN slow blink (terug naar idle)</div>
</div><!-- fragment --><hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md109"></a>
Hoe? (Architectuur &amp; Gedrag)</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md110"></a>
Hardware Interface</h2>
<p><b>RGB LED connectie</b>: </p><div class="fragment"><div class="line">Device Tree (DT):</div>
<div class="line">  leds {</div>
<div class="line">    compatible = &quot;pwm-leds&quot;;</div>
<div class="line">    red_pwm_led:   pwm_led_0 { pwms = &lt;&amp;pwm0 0 PWM_MSEC(20) ...&gt;; };</div>
<div class="line">    green_pwm_led: pwm_led_1 { pwms = &lt;&amp;pwm0 1 PWM_MSEC(20) ...&gt;; };</div>
<div class="line">    blue_pwm_led:  pwm_led_2 { pwms = &lt;&amp;pwm0 2 PWM_MSEC(20) ...&gt;; };</div>
<div class="line">  };</div>
</div><!-- fragment --><p><b>PWM duty cycle</b> (brightness control):</p><ul>
<li>Range: <b>0-100</b> (percentage, niet 0-255!)</li>
<li>0 = LED uit</li>
<li>50 = half brightness</li>
<li>100 = full brightness</li>
</ul>
<p><b>Color mixing</b> (RGB values 0-100):</p><ul>
<li>Rood: (100, 0, 0)</li>
<li>Groen: (0, 100, 0)</li>
<li>Blauw: (0, 0, 100)</li>
<li>Warm Wit: (100, 20, 20) - rood met hints groen/blauw</li>
<li>Oranje: (100, 50, 0) - rood + half groen</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md111"></a>
Pattern Implementation</h2>
<p><b>Constant pattern</b>:</p><ul>
<li>RGB waardes worden eenmalig ingesteld via <span class="tt">set_led_color(red, green, blue)</span></li>
<li>LED blijft aan, geen timer nodig</li>
<li>Gebruikt voor: <span class="tt">LED_STATUS_WAIT</span> (warm wit constant), <span class="tt">LED_STATUS_FOTA_ERROR</span> (rood constant)</li>
</ul>
<p><b>Blink pattern</b> (via <span class="tt">k_work_delayable</span>):</p><ul>
<li><span class="tt">k_work_delayable</span> work item met specifieke periode (100ms - 1000ms)</li>
<li>Work handler togglet ON/OFF state</li>
<li>ON phase: RGB waardes actief (bijv. 0,100,0 voor groen)</li>
<li>OFF phase: (0,0,0) - LED uit</li>
<li>Period halvering: blink period / 2 voor on/off timing</li>
<li>Gebruikt voor: alle andere statussen</li>
</ul>
<p><b>Implementatie Details</b>: </p><div class="fragment"><div class="line"><span class="comment">/* Brightness range: 0-100 (niet 0-255!) */</span></div>
<div class="line">led_set_brightness(<a class="code hl_variable" href="led_8c.html#a16989d704b66afb755235dc52390910e">led_pwm</a>, <a class="code hl_enumvalue" href="led_8c.html#a8785874f85756c2b2671417c4bed203aa20c3f7e3db2eca4ce0fe784975373384">LED_COLOR_RED</a>, 100);   <span class="comment">/* Full red */</span></div>
<div class="line">led_set_brightness(<a class="code hl_variable" href="led_8c.html#a16989d704b66afb755235dc52390910e">led_pwm</a>, <a class="code hl_enumvalue" href="led_8c.html#a8785874f85756c2b2671417c4bed203aae996fe9a5d49e8bb266dd657d129b549">LED_COLOR_GRN</a>, 50);    <span class="comment">/* Half green */</span></div>
<div class="line">led_set_brightness(<a class="code hl_variable" href="led_8c.html#a16989d704b66afb755235dc52390910e">led_pwm</a>, <a class="code hl_enumvalue" href="led_8c.html#a8785874f85756c2b2671417c4bed203aa3d37292fa40618e3260e047e72aee134">LED_COLOR_BLU</a>, 0);     <span class="comment">/* Blue off */</span></div>
<div class="ttc" id="aled_8c_html_a16989d704b66afb755235dc52390910e"><div class="ttname"><a href="led_8c.html#a16989d704b66afb755235dc52390910e">led_pwm</a></div><div class="ttdeci">static const struct device * led_pwm</div><div class="ttdef"><b>Definition</b> <a href="led_8c_source.html#l00182">led.c:182</a></div></div>
<div class="ttc" id="aled_8c_html_a8785874f85756c2b2671417c4bed203aa20c3f7e3db2eca4ce0fe784975373384"><div class="ttname"><a href="led_8c.html#a8785874f85756c2b2671417c4bed203aa20c3f7e3db2eca4ce0fe784975373384">LED_COLOR_RED</a></div><div class="ttdeci">@ LED_COLOR_RED</div><div class="ttdef"><b>Definition</b> <a href="led_8c_source.html#l00042">led.c:42</a></div></div>
<div class="ttc" id="aled_8c_html_a8785874f85756c2b2671417c4bed203aa3d37292fa40618e3260e047e72aee134"><div class="ttname"><a href="led_8c.html#a8785874f85756c2b2671417c4bed203aa3d37292fa40618e3260e047e72aee134">LED_COLOR_BLU</a></div><div class="ttdeci">@ LED_COLOR_BLU</div><div class="ttdef"><b>Definition</b> <a href="led_8c_source.html#l00044">led.c:44</a></div></div>
<div class="ttc" id="aled_8c_html_a8785874f85756c2b2671417c4bed203aae996fe9a5d49e8bb266dd657d129b549"><div class="ttname"><a href="led_8c.html#a8785874f85756c2b2671417c4bed203aae996fe9a5d49e8bb266dd657d129b549">LED_COLOR_GRN</a></div><div class="ttdeci">@ LED_COLOR_GRN</div><div class="ttdef"><b>Definition</b> <a href="led_8c_source.html#l00043">led.c:43</a></div></div>
</div><!-- fragment --><p><b>Blink Frequenties</b>:</p><ul>
<li>100ms (10 Hz) - <span class="tt">LED_STATUS_CLOUD_TX</span> - Zeer snel, cloud data TX</li>
<li>200ms (5 Hz) - <span class="tt">LED_STATUS_ACQUIRING</span> - Snel, data acquisitie</li>
<li>250ms (4 Hz) - <span class="tt">LED_STATUS_FOTA</span> - FOTA download</li>
<li>500ms (2 Hz) - <span class="tt">LED_STATUS_NETWORK_ERROR</span> - Medium, netwerk error</li>
<li>1000ms (1 Hz) - <span class="tt">LED_STATUS_IDLE</span>, <span class="tt">LED_STATUS_CLOUD_ERROR</span> - Langzaam, idle/error</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md112"></a>
State Management</h2>
<p><b>Module state tracking</b>:</p><ul>
<li>Current LED status (enum <a class="el" href="group__led.html#gaa0d9fa15febb4e4b1d6fdc2f2bdb94f5" title="LED status priorities.">led_status_priority</a>)</li>
<li>Active LED pattern (pointer naar led_patterns[])</li>
<li>Blink work item (k_work_delayable)</li>
<li>Network status tracking:<ul>
<li>modem_initialized (bool)</li>
<li>network_connected (bool)</li>
</ul>
</li>
<li>Cloud status tracking:<ul>
<li>cloud_ready (bool)</li>
</ul>
</li>
<li>FOTA status tracking:<ul>
<li>fota_active (bool) - download in progress</li>
<li>fota_error (bool) - download failed</li>
</ul>
</li>
<li>Acquisition tracking:<ul>
<li>acquiring (bool) - P1 data acquisition active</li>
<li>acquiring_timeout (k_work_delayable) - 10 second timeout</li>
</ul>
</li>
</ul>
<p><b>Update flow bij status change</b>: </p><div class="fragment"><div class="line">ZBUS message ontvangen (network/cloud/fota/trigger)</div>
<div class="line">    ‚îÇ</div>
<div class="line">    ‚ñº</div>
<div class="line">Update interne state variabelen</div>
<div class="line">  ‚îú‚îÄ NETWORK_CHAN: modem_initialized, network_connected</div>
<div class="line">  ‚îú‚îÄ CLOUD_CHAN: cloud_ready</div>
<div class="line">  ‚îú‚îÄ FOTA_CHAN: fota_active, fota_error</div>
<div class="line">  ‚îî‚îÄ TRIGGER_CHAN: acquiring = true, start 10s timeout</div>
<div class="line">    ‚îÇ</div>
<div class="line">    ‚ñº</div>
<div class="line">determine_led_status(state) - Bepaal hoogste priority status</div>
<div class="line">  Priority order (hoogste eerst):</div>
<div class="line">  1. fota_active? ‚Üí LED_STATUS_FOTA</div>
<div class="line">  2. fota_error? ‚Üí LED_STATUS_FOTA_ERROR</div>
<div class="line">  3. !modem_initialized? ‚Üí LED_STATUS_WAIT</div>
<div class="line">  4. !network_connected? ‚Üí LED_STATUS_NETWORK_ERROR</div>
<div class="line">  5. !cloud_ready? ‚Üí LED_STATUS_CLOUD_ERROR</div>
<div class="line">  6. acquiring? ‚Üí LED_STATUS_ACQUIRING</div>
<div class="line">  7. else ‚Üí LED_STATUS_IDLE</div>
<div class="line">    ‚îÇ</div>
<div class="line">    ‚ñº</div>
<div class="line">new_status != current_status?</div>
<div class="line">    ‚îÇ JA</div>
<div class="line">    ‚ñº</div>
<div class="line">apply_led_pattern(&amp;led_patterns[new_status])</div>
<div class="line">    ‚îú‚îÄ‚ñ∫ Cancel oude k_work_delayable (indien blink pattern)</div>
<div class="line">    ‚îú‚îÄ‚ñ∫ Configureer nieuwe RGB waardes (set_led_color)</div>
<div class="line">    ‚îî‚îÄ‚ñ∫ Schedule nieuwe k_work_delayable (indien blink pattern)</div>
</div><!-- fragment --><p><b>Note</b>: <span class="tt">LED_STATUS_CLOUD_TX</span> is in code gedefinieerd maar <b>niet actief</b> (commented out in determine_led_status). Feature voor toekomstige implementatie.</p>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md114"></a>
LED Feedback Waarde</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md115"></a>
User Experience Benefits</h2>
<p><b>Installatie fase</b>:</p><ul>
<li><b>WARM WIT constant</b>: Device boot - duidelijk dat het aan gaat (RGB: 100,20,20)</li>
<li><b>ROOD blink</b>: Network connecting - wacht even, bezig met verbinden</li>
<li><b>ORANJE blink</b>: Cloud connecting - bijna klaar (RGB: 100,50,0)</li>
<li><b>GROEN slow blink</b>: Ready to use! ‚úÖ</li>
</ul>
<p><b>Operationele fase</b>:</p><ul>
<li><b>GROEN slow blink</b>: Alles werkt normaal - visual confirmation</li>
<li><b>BLAUW fast blink</b>: Data wordt actief gelezen van slimme meter</li>
<li><b>GROEN very fast blink</b>: Data wordt verzonden naar cloud</li>
<li><b>ROOD blink</b>: Network probleem - immediate alert</li>
</ul>
<p><b>Troubleshooting via LED Pattern</b>:</p>
<div class="fragment"><div class="line">Klant: &quot;Apparaat werkt niet&quot;</div>
<div class="line"> </div>
<div class="line">Scenario 1: LED = WARM WIT constant (blijft hangen)</div>
<div class="line">‚Üí Boot probleem, modem init hangt ‚Üí Check logs, mogelijk firmware flash nodig</div>
<div class="line"> </div>
<div class="line">Scenario 2: LED = ROOD blink</div>
<div class="line">‚Üí Network issues ‚Üí Check SIM card, antenne, netwerk bereik</div>
<div class="line"> </div>
<div class="line">Scenario 3: LED = ORANJE blink (blijft hangen)</div>
<div class="line">‚Üí Cloud connecting issues ‚Üí Check provisioning, certificates</div>
<div class="line"> </div>
<div class="line">Scenario 4: LED = GROEN slow blink, maar geen data in cloud</div>
<div class="line">‚Üí Data pipeline OK, mogelijk probleem bij P1 meter ‚Üí Check P1 kabel</div>
<div class="line"> </div>
<div class="line">Scenario 5: LED = ROOD constant</div>
<div class="line">‚Üí FOTA error (kritiek!) ‚Üí Mogelijk corrupt firmware, recovery nodig</div>
<div class="line"> </div>
<div class="line">Scenario 6: LED = BLAUW fast blink (blijft hangen)</div>
<div class="line">‚Üí P1 acquisition hangt ‚Üí Check P1 meter connection, UART</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="autotoc_md116"></a>
Remote Support Voordelen</h2>
<p><b>Telefoon diagnostiek</b>:</p><ul>
<li>Support: "Welke kleur zie je?"</li>
<li>Klant: "Rood, knippert langzaam"</li>
<li>Support: "Network probleem. Check of SIM card goed zit."</li>
</ul>
<p><b>Geen technische kennis nodig</b>:</p><ul>
<li>Geen terminal/logs nodig voor eerste diagnose</li>
<li>Kleur + knipperpatroon ‚Üí direct probleem lokalisatie</li>
<li>90% van problemen diagnosticeerbaar via LED alleen</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md117"></a>
Future Uitbreidingen</h2>
<ul>
<li>‚è≥ <b>Brightness control</b> - Kconfig optie voor dimmen (slaapkamer gebruik)</li>
<li>‚è≥ <b>LED disable mode</b> - Volledig uitschakelen voor stealth deployment</li>
<li>‚è≥ <b>Custom patterns</b> - User-defined patronen via cloud config</li>
<li>‚è≥ <b>Error codes</b> - Blink count voor specific error types (2√ó rood = network, 3√ó rood = cloud, etc.)</li>
<li>‚è≥ <b>CLOUD_TX pattern activeren</b> - Uncomment in code, add trigger logic</li>
<li>‚è≥ <b>Multi-color transitions</b> - Smooth fade tussen kleuren voor visuele flow</li>
</ul>
<hr  />
 <div class="fragment"><div class="line">Troubleshooting Checklist (LED Patterns)</div>
<div class="line">‚îú‚îÄ WARM WIT constant (blijft hangen) ‚Üí Boot/modem init failure</div>
<div class="line">‚îú‚îÄ ROOD blink 2Hz ‚Üí Network disconnected</div>
<div class="line">‚îú‚îÄ ROOD constant ‚Üí FOTA error (kritiek!)</div>
<div class="line">‚îú‚îÄ ORANJE blink ‚Üí Cloud not ready</div>
<div class="line">‚îú‚îÄ BLAUW fast blink ‚Üí Data acquisitie actief (normal), of hangt (probleem)</div>
<div class="line">‚îú‚îÄ GROEN very fast blink (10Hz) ‚Üí Cloud TX (‚ö†Ô∏è currently disabled in code)</div>
<div class="line">‚îú‚îÄ GROEN 4Hz blink ‚Üí FOTA download actief</div>
<div class="line">‚îú‚îÄ GROEN slow blink ‚Üí Normal operation ‚úÖ</div>
<div class="line">‚îî‚îÄ LED uit ‚Üí Power issue, LED hardware defect, of LED disabled</div>
</div><!-- fragment --><hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md120"></a>
Zie Ook</h1>
<ul>
<li><a class="el" href="led_8c.html">led.c</a> - Implementatie</li>
<li><a class="el" href="led_8h.html">led.h</a> - Public API</li>
<li><a class="el" href="group__network.html">Network - API Referentie</a> - Network status bron</li>
<li><a class="el" href="group__cloud.html">Cloud - API Referentie</a> - Cloud status bron </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
